<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OSINT Investigation Dashboard</title>
  <style>
    :root {
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-tertiary: #2d2d2d;
  --text-primary: #e0e0e0;
  --text-secondary: #a0a0a0;
  --border-color: #333333;
  --accent-color: #3b82f6;
  --danger-color: #ef4444;
  --username-color: #3b82f6;
  --name-color: #10b981;
  --email-color: #f59e0b;
  --social-media-color: #8b5cf6;
  --encryption-key-color: #ec4899;
  --password-color: #ef4444;
  --custom-field-color: #ffffff;
  --crypto-wallet-color: #f1c40f;
  --ip-address-color: #00b4d8;
  --domain-color: #ff6b6b;
  --onion-site-color: #9b59b6;
  --location-color: #2ecc71;
  --image-color: #e67e22;
}

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .navbar {
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-primary);
      font-weight: bold;
      font-size: 1.25rem;
    }

    .logo svg {
      width: 2rem;
      height: 2rem;
      fill: none;
      stroke: var(--accent-color);
      stroke-width: 2;
    }

    .actions {
      display: flex;
      gap: 1rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: none;
      transition: background-color 0.2s;
    }

    .btn-primary {
      background-color: var(--accent-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #2563eb;
    }

    .btn-secondary {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background-color: #3d3d3d;
    }

    .btn svg {
      width: 1rem;
      height: 1rem;
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 200px;
      background-color: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
      position: relative;
      z-index: 5;
    }

    .sidebar-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .widget-item {
      padding: 0.5rem;
      border-radius: 0.25rem;
      background-color: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      cursor: grab;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.2s;
    }

    .widget-item:hover {
      background-color: #3d3d3d;
    }

    .widget-item.grabbed {
      opacity: 0.6;
    }

    .widget-icon {
      width: 1.5rem;
      height: 1.5rem;
      flex-shrink: 0;
      stroke-width: 2;
      fill: none;
    }

    .widget-label {
      font-size: 0.875rem;
      color: var(--text-primary);
    }

    .workspace-container {
      flex: 1;
      display: flex;
      position: relative;
      overflow: hidden;
    }

    .workspace {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: visible;
      background-color: var(--bg-primary);
      background-image: radial-gradient(circle, #333333 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .workspace-canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .zoom-controls {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: flex;
      background-color: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      overflow: hidden;
      z-index: 100;
    }

    .zoom-btn {
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: transparent;
      border: none;
      cursor: pointer;
      color: var(--text-primary);
    }

    .zoom-btn:hover {
      background-color: var(--bg-tertiary);
    }

    .tool-btn {
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: transparent;
      border: none;
      cursor: pointer;
      color: var(--text-primary);
    }

    .tool-btn.active {
      background-color: var(--bg-tertiary);
      color: var(--accent-color);
    }

    .tool-btn:hover {
      background-color: var(--bg-tertiary);
    }

    .divider {
      width: 1px;
      background-color: var(--border-color);
    }

    .node {
      position: absolute;
      min-width: 120px;
      background-color: var(--bg-secondary);
      border-radius: 0.375rem;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      user-select: none;
      transform-origin: top left;
      transition: box-shadow 0.2s;
      display: inline-block;
      padding: 0.25rem;
    }

    .node.dragging {
      z-index: 1000;
    }

    .node.selected {
      box-shadow: 0 0 0 2px var(--accent-color), 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .node-header {
      padding: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-color);
    }

    .node-icon-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .node-icon {
      width: 1rem;
      height: 1rem;
      stroke-width: 2;
      flex-shrink: 0;
    }

    .node-label {
      font-size: 0.75rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .node-close {
      width: 1rem;
      height: 1rem;
      border: none;
      background: transparent;
      color: var(--danger-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .node.selected .node-close {
      opacity: 1;
    }

    .node-content {
      padding: 0.5rem;
      font-size: 0.75rem;
      min-height: 1.5rem;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .node-empty {
      font-style: italic;
      color: var(--text-secondary);
      opacity: 0.7;
    }

    .node-connector {
      position: absolute;
      width: 8px;
      height: 8px;
      background: var(--accent-color);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.2s;
      cursor: pointer;
    }

    .node:hover .node-connector {
      opacity: 1;
    }

    .node-connector.start {
      right: -4px;
      top: 50%;
      transform: translateY(-50%);
    }

    .node-connector.end {
      left: -4px;
      top: 50%;
      transform: translateY(-50%);
    }

    .properties-panel {
      width: 250px;
      background-color: var(--bg-secondary);
      border-left: 1px solid var(--border-color);
      padding: 1rem;
      display: none;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .properties-panel.visible {
      display: flex;
    }

    .properties-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .properties-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .form-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .form-input {
      padding: 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid var(--border-color);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 0.875rem;
      width: 100%;
    }

    .form-input:disabled {
      background-color: #3d3d3d;
      color: var(--text-secondary);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .form-select {
      padding: 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid var(--border-color);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 0.875rem;
      width: 100%;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .form-textarea {
      padding: 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid var(--border-color);
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 0.875rem;
      width: 100%;
      min-height: 5rem;
      resize: vertical;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .status-bar {
      background-color: var(--bg-tertiary);
      padding: 0.25rem 1rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      border-top: 1px solid var(--border-color);
    }

    .status-metrics {
      display: flex;
      gap: 1rem;
    }

    .file-input {
      display: none;
    }

    .edge-path {
      stroke: var(--text-secondary);
      stroke-width: 2;
      fill: none;
      pointer-events: all;
      transition: stroke 0.2s, stroke-width 0.2s;
      marker-mid: url(#arrowhead);
    }

    .edge-path:hover {
      stroke: var(--accent-color);
    }

    .edge-path.selected {
      stroke: var(--accent-color);
      stroke-width: 3;
    }

    .edge-delete {
      fill: var(--danger-color);
      font-size: 12px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .edge-reverse {
      fill: var(--accent-color);
      font-size: 12px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .edge-group.selected .edge-delete,
    .edge-group.selected .edge-reverse {
      opacity: 1;
    }

    .temp-edge {
      stroke: var(--accent-color);
      stroke-width: 2;
      fill: none;
      stroke-dasharray: 5;
    }

    .edge-menu {
      position: absolute;
      background-color: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      padding: 0.5rem;
      display: none;
      flex-direction: column;
      gap: 0.25rem;
      z-index: 1500;
    }

    .edge-menu.visible {
      display: flex;
    }

    .edge-menu-btn {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 0.75rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      border: none;
      transition: background-color 0.2s;
    }

    .edge-menu-btn:hover {
      background-color: #3d3d3d;
    }

    .edge-menu-btn svg {
      width: 1rem;
      height: 1rem;
    }

    .delete-prompt {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
      border: 1px solid var(--accent-color);
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5), 0 0 10px rgba(59, 130, 246, 0.3);
      z-index: 2000;
      width: 320px;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .delete-prompt.visible {
      display: block;
    }

    .delete-prompt-header {
      font-size: 1.25rem;
      color: var(--text-primary);
      margin-bottom: 1rem;
      text-align: center;
    }

    .delete-prompt p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .delete-prompt-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .delete-prompt-btn {
      padding: 0.5rem 1.5rem;
      border-radius: 0.25rem;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: background-color 0.2s, transform 0.2s;
    }

    .delete-prompt-btn.delete {
      background-color: var(--danger-color);
      color: white;
    }

    .delete-prompt-btn.delete:hover {
      background-color: #c53030;
      transform: scale(1.05);
    }

    .delete-prompt-btn.cancel {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .delete-prompt-btn.cancel:hover {
      background-color: #3d3d3d;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <svg viewBox="0 0 24 24">
        <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
      </svg>
      <span>OSINT Investigation Dashboard</span>
    </div>
    <div class="actions">
      <button id="export-btn" class="btn btn-primary">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Export .itsy
      </button>
      <label for="import-file" class="btn btn-secondary">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        Import .itsy
      </label>
      <input type="file" id="import-file" class="file-input" accept=".itsy">
    </div>
  </header>

  <main class="main-container">
    <aside class="sidebar">
      <h2 class="sidebar-title">Widgets</h2>
      <div id="widget-username" class="widget-item" draggable="true" data-type="USERNAME">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--username-color)">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span class="widget-label">Username</span>
      </div>
      <div id="widget-name" class="widget-item" draggable="true" data-type="NAME">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--name-color)">
          <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"></path>
          <path d="M12 14c-4.97 0-9 2.015-9 4.5V20h18v-1.5c0-2.485-4.03-4.5-9-4.5z"></path>
        </svg>
        <span class="widget-label">Name</span>
      </div>
      <div id="widget-email" class="widget-item" draggable="true" data-type="EMAIL">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--email-color)">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        <span class="widget-label">Email</span>
      </div>
      <div id="widget-social" class="widget-item" draggable="true" data-type="SOCIAL_MEDIA">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--social-media-color)">
          <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
        </svg>
        <span class="widget-label">Social Media ID</span>
      </div>
      <div id="widget-encryption" class="widget-item" draggable="true" data-type="ENCRYPTION_KEY">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--encryption-key-color)">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          <circle cx="12" cy="16" r="1"></circle>
        </svg>
        <span class="widget-label">Encryption Key</span>
      </div>
      <div id="widget-password" class="widget-item" draggable="true" data-type="PASSWORD">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--password-color)">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          <line x1="12" y1="15" x2="12" y2="17"></line>
        </svg>
        <span class="widget-label">Password</span>
      </div>
      <div id="widget-crypto" class="widget-item" draggable="true" data-type="CRYPTO_WALLET">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--crypto-wallet-color)">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"></path>
          <circle cx="15" cy="12" r="2"></circle>
        </svg>
        <span class="widget-label">Crypto Wallet</span>
      </div>
      <div id="widget-custom" class="widget-item" draggable="true" data-type="CUSTOM_FIELD">
        <svg class="widget-icon" viewBox="0 0 24 24" stroke="var(--custom-field-color)">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="9" x2="15" y2="15"></line>
          <line x1="15" y1="9" x2="9" y2="15"></line>
        </svg>
        <span class="widget-label">Custom Field</span>
      </div>
    </aside>

    <div class="workspace-container">
      <div class="workspace" id="workspace">
        <svg class="workspace-canvas" id="canvas">
          <defs>
            <marker id="arrowhead" 
                    markerWidth="10" 
                    markerHeight="7" 
                    refX="5" 
                    refY="3.5" 
                    orient="auto"
                    markerUnits="strokeWidth">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--text-secondary)" />
            </marker>
          </defs>
          <g class="edges" id="edges"></g>
        </svg>
        <div id="nodes-container"></div>
      </div>

      <div class="zoom-controls">
        <button id="select-tool" class="tool-btn active" title="Select Tool">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path>
          </svg>
        </button>
        <button id="connect-tool" class="tool-btn" title="Connect Tool">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
        </button>
        <div class="divider"></div>
        <button id="zoom-in" class="zoom-btn" title="Zoom In">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            <line x1="11" y1="8" x2="11" y2="14"></line>
            <line x1="8" y1="11" x2="14" y2="11"></line>
          </svg>
        </button>
        <button id="zoom-out" class="zoom-btn" title="Zoom Out">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            <line x1="8" y1="11" x2="14" y2="11"></line>
          </svg>
        </button>
      </div>

      <aside class="properties-panel" id="properties-panel">
        <div class="properties-header">
          <svg id="property-icon" class="widget-icon" viewBox="0 0 24 24"></svg>
          <h2 class="properties-title" id="property-title">Node Properties</h2>
        </div>
        <div class="form-group">
          <label class="form-label" for="property-type">Type</label>
          <input type="text" id="property-type" class="form-input" disabled>
        </div>
        <div class="form-group">
          <label class="form-label" for="property-label">Label</label>
          <input type="text" id="property-label" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label" for="property-value">Value</label>
          <input type="text" id="property-value" class="form-input">
        </div>
        <div class="form-group" id="platform-group" style="display: none;">
          <label class="form-label" for="property-platform">Platform</label>
          <select id="property-platform" class="form-select">
            <!-- Options populated dynamically -->
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="property-notes">Notes</label>
          <textarea id="property-notes" class="form-textarea"></textarea>
        </div>
      </aside>

      <div class="edge-menu" id="edge-menu">
        <button class="edge-menu-btn" id="edge-delete">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Delete
        </button>
        <button class="edge-menu-btn" id="edge-reverse">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
          Reverse
        </button>
      </div>
    </div>
  </main>

  <footer class="status-bar">
    <div class="status-metrics">
      <span id="nodes-count">0 Nodes</span>
      <span id="edges-count">0 Connections</span>
    </div>
    <div id="zoom-level">Zoom: 100%</div>
  </footer>

  <div class="delete-prompt" id="delete-prompt">
    <h3 class="delete-prompt-header">Delete Confirmation</h3>
    <p>Are you sure you want to delete this item?</p>
    <div class="delete-prompt-buttons">
      <button class="delete-prompt-btn cancel" id="delete-cancel">Cancel</button>
      <button class="delete-prompt-btn delete" id="delete-confirm">Delete</button>
    </div>
  </div>

  <script>
    const WIDGET_TYPES = {
      USERNAME: {
        type: 'USERNAME',
        color: 'var(--username-color)',
        label: 'Username',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>`
      },
      NAME: {
        type: 'NAME',
        color: 'var(--name-color)',
        label: 'Name',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"></path>
          <path d="M12 14c-4.97 0-9 2.015-9 4.5V20h18v-1.5c0-2.485-4.03-4.5-9-4.5z"></path>
        </svg>`
      },
      EMAIL: {
        type: 'EMAIL',
        color: 'var(--email-color)',
        label: 'Email',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>`
      },
      SOCIAL_MEDIA: {
        type: 'SOCIAL_MEDIA',
        color: 'var(--social-media-color)',
        label: 'Social Media ID',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
        </svg>`,
        icons: {
          'Discord': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.045-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 0-.08.013c-.126.087-.258.177-.39.268a.071.071 0 0 0-.019.018c.06.038.318.217 1.026.633a17.837 17.837 0 0 0 5.078 0c.708-.416.966-.595 1.026-.633a.076.076 0 0 0-.019-.018c-.132-.09-.264-.18-.39-.268a.078.078 0 0 0-.08-.013c-.597.27-1.22.56-1.872.892a.077.077 0 0 0-.041.106c.352.698.764 1.364 1.226 1.994a.077.077 0 0 0 .084.028 19.892 19.892 0 0 0 5.992-3.03.082.082 0 0 0 .032-.057c.418-4.477-.436-9.01-3.51-13.688a.066.066 0 0 0-.032-.027zM8.5 15.5c-.687 0-1.25-.563-1.25-1.25s.563-1.25 1.25-1.25 1.25.563 1.25 1.25S9.187 15.5 8.5 15.5zm7 0c-.687 0-1.25-.563-1.25-1.25s.563-1.25 1.25-1.25 1.25.563 1.25 1.25S15.687 15.5 15.5 15.5z"></path>
          </svg>`,
          'Facebook': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
          </svg>`,
          'Github': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
          </svg>`,
          'Instagram': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>`,
          'Twitter': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
          </svg>`,
          'Something else': `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 8v8M8 12h8"></path>
          </svg>`
        }
      },
      ENCRYPTION_KEY: {
        type: 'ENCRYPTION_KEY',
        color: 'var(--encryption-key-color)',
        label: 'Encryption Key',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          <circle cx="12" cy="16" r="1"></circle>
        </svg>`
      },
      PASSWORD: {
        type: 'PASSWORD',
        color: 'var(--password-color)',
        label: 'Password',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          <line x1="12" y1="15" x2="12" y2="17"></line>
        </svg>`
      },
      CUSTOM_FIELD: {
        type: 'CUSTOM_FIELD',
        color: 'var(--custom-field-color)',
        label: 'Custom Field',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="9" x2="15" y2="15"></line>
          <line x1="15" y1="9" x2="9" y2="15"></line>
        </svg>`
      },
      CRYPTO_WALLET: {
        type: 'CRYPTO_WALLET',
        color: 'var(--crypto-wallet-color)',
        label: 'Crypto Wallet',
        icon: `<svg viewBox="0 0 24 24" stroke="currentColor" fill="none">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"></path>
          <circle cx="15" cy="12" r="2"></circle>
        </svg>`,
        icons: {
  "Bitcoin": "<svg viewBox=\"0 0 273.6 360\" fill=\"currentColor\" stroke=\"none\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M217.021,167.042c18.631-9.483,30.288-26.184,27.565-54.007c-3.667-38.023-36.526-50.773-78.006-54.404l-0.008-52.741 h-32.139l-0.009,51.354c-8.456,0-17.076,0.166-25.657,0.338L108.76,5.897l-32.11-0.003l-0.006,52.728 c-6.959,0.142-13.793,0.277-20.466,0.277v-0.156l-44.33-0.018l0.006,34.282c0,0,23.734-0.446,23.343-0.013 c13.013,0.009,17.262,7.559,18.484,14.076l0.01,60.083v84.397c-0.573,4.09-2.984,10.625-12.083,10.637 c0.414,0.364-23.379-0.004-23.379-0.004l-6.375,38.335h41.817c7.792,0.009,15.448,0.13,22.959,0.19l0.028,53.338l32.102,0.009 l-0.009-52.779c8.832,0.18,17.357,0.258,25.684,0.247l-0.009,52.532h32.138l0.018-53.249c54.022-3.1,91.842-16.697,96.544-67.385 C266.916,192.612,247.692,174.396,217.021,167.042z M109.535,95.321c18.126,0,75.132-5.767,75.14,32.064 c-0.008,36.269-56.996,32.032-75.14,32.032V95.321z M109.521,262.447l0.014-70.672c21.778-0.006,90.085-6.261,90.094,35.32 C199.638,266.971,131.313,262.431,109.521,262.447z\"/></svg>",
  "Doge": "<svg viewBox=\"0 0 225.000000 225.000000\" fill=\"currentColor\" stroke=\"none\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M762 2147 c-25 -29 -35 -111 -30 -237 7 -165 6 -172 -45 -198 -23 -12 -91 -52 -151 -89 -120 -75 -111 -63 -205 -263 -72 -151 -90 -221 -98 -365 -17 -354 189 -682 522 -828 133 -58 207 -72 375 -71 139 1 164 3 244 28 166 50 290 123 399 234 105 106 174 220 219 362 20 66 23 95 23 235 0 136 -3 173 -23 245 -27 97 -86 230 -132 293 -41 58 -46 100 -24 189 13 51 18 107 18 183 -1 118 -13 180 -42 216 -34 40 -64 21 -227 -147 -172 -177 -159 -171 -313 -134 -46 11 -107 20 -137 20 -29 0 -61 3 -70 6 -9 4 -31 36 -50 73 -45 89 -127 204 -168 235 -37 28 -69 33 -85 13z\"/></svg>",
  "Ethereum": "<svg viewBox=\"0 0 32 32\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M15.927 23.959l-9.823-5.797 9.817 13.839 9.828-13.839-9.828 5.797zM16.073 0l-9.819 16.297 9.819 5.807 9.823-5.801z\"/></svg>",
  "Monero": "<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 0C5.365 0 0 5.373 0 12.015c0 1.335.228 2.607.618 3.81h3.577V5.729L12 13.545l7.805-7.815v10.095h3.577c.389-1.203.618-2.475.618-3.81C24 5.375 18.635 0 12 0zm-1.788 15.307l-3.417-3.421v6.351H1.758C3.87 21.689 7.678 24 12 24s8.162-2.311 10.245-5.764h-5.04v-6.351l-3.386 3.421-1.788 1.79-1.814-1.79h-.005z\"/></svg>",
  "Solana": "<svg viewBox=\"0 0 225.000000 225.000000\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M678 1768 c-25 -20 -208 -301 -208 -319 0 -39 12 -39 566 -37 l539 3 103 153 c56 84 102 159 102 167 0 7 -7 21 -16 29 -14 14 -77 16 -543 16 -407 0 -531 -3 -543 -12z m910 -173 l-63 -95 -463 0 -462 0 62 95 63 95 463 0 462 0 -62 -95z\"/><path d=\"M478 1285 c-10 -23 -2 -38 95 -185 l107 -160 540 0 540 0 12 25 c10 23 2 38 -95 185 l-107 160 -540 0 -540 0 -12 -25z m1110 -160 l62 -95 -462 0 -463 0 -63 95 -62 95 462 0 463 0 63 -95z\"/><path d=\"M668 823 c-32 -36 -198 -295 -198 -308 0 -7 7 -21 16 -29 14 -14 77 -16 550 -16 l534 0 101 152 c56 83 104 160 107 170 12 48 17 48 -558 48 -499 0 -538 -1 -552 -17z m920 -168 l-63 -95 -463 0 -462 0 62 95 63 95 463 0 462 0 -62 -95z\"/></svg>",
  "Something else": "<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M12 8v8M8 12h8\"/></svg>"
}

      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      const workspace = document.getElementById('workspace');
      const canvas = document.getElementById('canvas');
      const edgesGroup = document.getElementById('edges');
      const nodesContainer = document.getElementById('nodes-container');
      const propertiesPanel = document.getElementById('properties-panel');
      const propertyIcon = document.getElementById('property-icon');
      const propertyTitle = document.getElementById('property-title');
      const propertyType = document.getElementById('property-type');
      const propertyValue = document.getElementById('property-value');
      const propertyNotes = document.getElementById('property-notes');
      const propertyLabel = document.getElementById('property-label');
      const propertyPlatform = document.getElementById('property-platform');
      const platformGroup = document.getElementById('platform-group');
      const edgeMenu = document.getElementById('edge-menu');
      const edgeDeleteBtn = document.getElementById('edge-delete');
      const edgeReverseBtn = document.getElementById('edge-reverse');
      const exportBtn = document.getElementById('export-btn');
      const importFile = document.getElementById('import-file');
      const nodesCount = document.getElementById('nodes-count');
      const edgesCount = document.getElementById('edges-count');
      const zoomLevel = document.getElementById('zoom-level');
      const zoomInBtn = document.getElementById('zoom-in');
      const zoomOutBtn = document.getElementById('zoom-out');
      const selectToolBtn = document.getElementById('select-tool');
      const connectToolBtn = document.getElementById('connect-tool');
      const deletePrompt = document.getElementById('delete-prompt');
      const deleteConfirm = document.getElementById('delete-confirm');
      const deleteCancel = document.getElementById('delete-cancel');

      let nodes = [];
      let edges = [];
      let selectedNodeId = null;
      let selectedEdgeId = null;
      let zoom = 1;
      let isDragging = false;
      let isPanning = false;
      let dragOffsetX = 0;
      let dragOffsetY = 0;
      let panOffsetX = 0;
      let panOffsetY = 0;
      let isCreatingEdge = false;
      let edgeStartNodeId = null;
      let tempEdge = null;
      let currentTool = 'select';

      function updateCanvasSize() {
        const baseWidth = workspace.offsetWidth;
        const baseHeight = workspace.offsetHeight;
        canvas.setAttribute('width', baseWidth * zoom);
        canvas.setAttribute('height', baseHeight * zoom);
        canvas.style.width = `${baseWidth}px`;
        canvas.style.height = `${baseHeight}px`;
      }

      window.addEventListener('resize', () => {
        updateCanvasSize();
        renderEdges();
      });
      updateCanvasSize();

      selectToolBtn.addEventListener('click', () => {
        currentTool = 'select';
        selectToolBtn.classList.add('active');
        connectToolBtn.classList.remove('active');
        if (isCreatingEdge) {
          isCreatingEdge = false;
          edgeStartNodeId = null;
          if (tempEdge) {
            tempEdge.remove();
            tempEdge = null;
          }
        }
        deselectEdge();
      });

      connectToolBtn.addEventListener('click', () => {
        currentTool = 'connect';
        connectToolBtn.classList.add('active');
        selectToolBtn.classList.remove('active');
        deselectEdge();
      });

      zoomInBtn.addEventListener('click', () => {
        zoom = Math.min(zoom + 0.1, 2);
        updateZoom();
      });

      zoomOutBtn.addEventListener('click', () => {
        zoom = Math.max(zoom - 0.1, 0.5);
        updateZoom();
      });

      function updateZoom() {
        updateCanvasSize();
        const transform = `translate(${panOffsetX}px, ${panOffsetY}px) scale(${zoom})`;
        nodesContainer.style.transform = transform;
        edgesGroup.style.transform = transform;
        renderEdges();
        zoomLevel.textContent = `Zoom: ${Math.round(zoom * 100)}%`;
      }

      workspace.addEventListener('mousedown', (e) => {
        if (currentTool === 'select' && !e.target.closest('.node') && !e.target.closest('.edge-group') && !e.target.closest('.edge-menu')) {
          isPanning = true;
          dragOffsetX = e.clientX - panOffsetX;
          dragOffsetY = e.clientY - panOffsetY;
          workspace.style.cursor = 'grabbing';
          deselectEdge();
          if (selectedNodeId) {
            document.getElementById(selectedNodeId).classList.remove('selected');
            propertiesPanel.classList.remove('visible');
            selectedNodeId = null;
          }
        }
      });

      document.addEventListener('mousemove', (e) => {
        if (isPanning) {
          panOffsetX = e.clientX - dragOffsetX;
          panOffsetY = e.clientY - dragOffsetY;
          updateZoom();
        }
        if (isCreatingEdge && tempEdge) {
          const rect = workspace.getBoundingClientRect();
          const endX = (e.clientX - rect.left - panOffsetX) / zoom;
          const endY = (e.clientY - rect.top - panOffsetY) / zoom;
          const startNode = getNodeById(edgeStartNodeId);
          const startX = startNode.x + startNode.offsetWidth;
          const startY = startNode.y + startNode.offsetHeight / 2;
          const controlX1 = startX + (endX - startX) * 0.3;
          const controlX2 = startX + (endX - startX) * 0.7;
          tempEdge.setAttribute('d', `M${startX},${startY} C${controlX1},${startY} ${controlX2},${endY} ${endX},${endY}`);
        }
      });

      document.addEventListener('mouseup', (e) => {
        if (isPanning) {
          isPanning = false;
          workspace.style.cursor = 'default';
        }
        if (isCreatingEdge) {
          const target = e.target.closest('.node');
          if (target && target.id !== edgeStartNodeId) {
            const edgeId = `edge-${Date.now()}`;
            edges.push({
              id: edgeId,
              from: edgeStartNodeId,
              to: target.id
            });
            renderEdges();
            updateEdgeCount();
          }
          isCreatingEdge = false;
          edgeStartNodeId = null;
          if (tempEdge) {
            tempEdge.remove();
            tempEdge = null;
          }
        }
      });

      document.querySelectorAll('.widget-item').forEach(widget => {
        widget.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', widget.dataset.type);
          widget.classList.add('grabbed');
        });

        widget.addEventListener('dragend', () => {
          widget.classList.remove('grabbed');
        });
      });

      workspace.addEventListener('dragover', (e) => {
        e.preventDefault();
      });

      workspace.addEventListener('drop', (e) => {
        e.preventDefault();
        const type = e.dataTransfer.getData('text/plain');
        if (WIDGET_TYPES[type]) {
          const rect = workspace.getBoundingClientRect();
          const x = (e.clientX - rect.left - panOffsetX) / zoom;
          const y = (e.clientY - rect.top - panOffsetY) / zoom;
          createNode(type, x, y);
        }
      });

      function createNode(type, x, y) {
        const nodeId = `node-${Date.now()}`;
        const nodeType = WIDGET_TYPES[type];
        
        const node = {
          id: nodeId,
          type: type,
          label: nodeType.label,
          value: '',
          notes: '',
          x: x,
          y: y
        };
        if (type === 'SOCIAL_MEDIA') {
          node.platform = 'Discord';
        } else if (type === 'CRYPTO_WALLET') {
          node.platform = 'Bitcoin';
        }

        nodes.push(node);
        renderNode(nodeId);
        updateNodeCount();
        return nodeId;
      }

      function getNodeById(id) {
        return nodes.find(n => n.id === id) || document.getElementById(id);
      }

      function renderNode(nodeId) {
        const node = getNodeById(nodeId);
        if (!node) return;

        const nodeType = WIDGET_TYPES[node.type];
        let nodeIcon = nodeType.icon;
        if (node.type === 'SOCIAL_MEDIA' && node.platform) {
          nodeIcon = nodeType.icons[node.platform];
        } else if (node.type === 'CRYPTO_WALLET' && node.platform) {
          nodeIcon = nodeType.icons[node.platform];
        }

        let nodeElement = document.getElementById(nodeId);

        if (!nodeElement) {
          nodeElement = document.createElement('div');
          nodeElement.id = nodeId;
          nodeElement.className = 'node';
          nodeElement.innerHTML = `
            <div class="node-header">
              <div class="node-icon-label">
                <svg class="node-icon" style="stroke: ${nodeType.color}">${nodeIcon}</svg>
                <span class="node-label">${node.label}</span>
              </div>
              <button class="node-close">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="node-content ${node.value ? '' : 'node-empty'}">
              ${node.value || 'No value'}
            </div>
            <div class="node-connector start" data-node="${nodeId}"></div>
            <div class="node-connector end" data-node="${nodeId}"></div>
          `;
          nodesContainer.appendChild(nodeElement);

          nodeElement.addEventListener('mousedown', (e) => {
            if (currentTool === 'select') {
              startDragging(e);
            } else if (currentTool === 'connect') {
              startEdge(e);
            }
          });
          nodeElement.querySelector('.node-close').addEventListener('click', (e) => {
            e.stopPropagation();
            deletePrompt.classList.add('visible');
            deleteConfirm.onclick = () => {
              removeNode(nodeId);
              deletePrompt.classList.remove('visible');
            };
            deleteCancel.onclick = () => {
              deletePrompt.classList.remove('visible');
            };
          });
        }

        nodeElement.style.left = `${node.x}px`;
        nodeElement.style.top = `${node.y}px`;

        const nodeLabel = nodeElement.querySelector('.node-label');
        const nodeContent = nodeElement.querySelector('.node-content');
        const nodeIconElement = nodeElement.querySelector('.node-icon');
        nodeLabel.textContent = node.label;
        nodeContent.textContent = node.value || 'No value';
        nodeContent.classList.toggle('node-empty', !node.value);
        nodeIconElement.innerHTML = nodeIcon;
        nodeIconElement.style.stroke = nodeType.color;
      }

      function startEdge(e) {
        if (currentTool !== 'connect') return;
        isCreatingEdge = true;
        edgeStartNodeId = e.target.closest('.node').id;
        const tempPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        tempPath.classList.add('temp-edge');
        edgesGroup.appendChild(tempPath);
        tempEdge = tempPath;
        e.stopPropagation();
      }

      function startDragging(e) {
        if (currentTool !== 'select' || e.target.classList.contains('node-connector')) return;
        const nodeElement = e.target.closest('.node');
        if (!nodeElement) return;

        const nodeId = nodeElement.id;
        const node = getNodeById(nodeId);

        isDragging = true;
        dragOffsetX = e.clientX / zoom - node.x - panOffsetX;
        dragOffsetY = e.clientY / zoom - node.y - panOffsetY;
        nodeElement.classList.add('selected');
        nodeElement.classList.add('dragging');
        selectNode(nodeId);

        const moveHandler = (moveEvent) => {
          if (isDragging) {
            node.x = moveEvent.clientX / zoom - dragOffsetX - panOffsetX;
            node.y = moveEvent.clientY / zoom - dragOffsetY - panOffsetY;
            nodeElement.style.left = `${node.x}px`;
            nodeElement.style.top = `${node.y}px`;
            renderEdges();
          }
        };

        const upHandler = () => {
          if (isDragging) {
            isDragging = false;
            nodeElement.classList.remove('dragging');
            nodeElement.classList.add('selected');
            document.removeEventListener('mousemove', moveHandler);
            document.removeEventListener('mouseup', upHandler);
          }
        };

        document.addEventListener('mousemove', moveHandler);
        document.addEventListener('mouseup', upHandler);
        e.stopPropagation();
      }

      function removeNode(nodeId) {
        nodes = nodes.filter(n => n.id !== nodeId);
        const nodeElement = document.getElementById(nodeId);
        if (nodeElement) nodeElement.remove();
        edges = edges.filter(e => e.from !== nodeId && e.to !== nodeId);
        updateNodeCount();
        updateEdgeCount();
        renderEdges();
        if (selectedNodeId === nodeId) {
          propertiesPanel.classList.remove('visible');
          selectedNodeId = null;
        }
      }

      function selectNode(nodeId) {
        const prevSelected = document.querySelector('.node.selected');
        if (prevSelected) prevSelected.classList.remove('selected');

        selectedNodeId = nodeId;
        const node = getNodeById(nodeId);
        const nodeType = WIDGET_TYPES[node.type];

        propertiesPanel.classList.add('visible');
        propertyIcon.innerHTML = nodeType.icon;
        if (node.type === 'SOCIAL_MEDIA' && node.platform) {
          propertyIcon.innerHTML = nodeType.icons[node.platform];
        } else if (node.type === 'CRYPTO_WALLET' && node.platform) {
          propertyIcon.innerHTML = nodeType.icons[node.platform];
        }
        propertyIcon.style.stroke = nodeType.color;
        propertyTitle.textContent = nodeType.label;
        propertyType.value = node.type;
        propertyLabel.value = node.label;
        propertyValue.value = node.value;
        propertyNotes.value = node.notes;

        if (node.type === 'SOCIAL_MEDIA' || node.type === 'CRYPTO_WALLET') {
          platformGroup.style.display = 'block';
          const platforms = node.type === 'SOCIAL_MEDIA' ?
            ['Discord', 'Facebook', 'Github', 'Instagram', 'Twitter', 'Something else'] :
            ['Bitcoin', 'Doge', 'Ethereum', 'Monero', 'Solana', 'Something else'];
          propertyPlatform.innerHTML = platforms.map(platform => 
            `<option value="${platform}" ${node.platform === platform ? 'selected' : ''}>${platform}</option>`
          ).join('');
          propertyPlatform.value = node.platform || platforms[0];
          propertyPlatform.onchange = () => {
            node.platform = propertyPlatform.value;
            renderNode(nodeId);
          };
        } else {
          platformGroup.style.display = 'none';
        }

        deselectEdge();

        propertyLabel.oninput = () => {
          node.label = propertyLabel.value;
          renderNode(nodeId);
        };
        propertyValue.oninput = () => {
          node.value = propertyValue.value;
          renderNode(nodeId);
        };
        propertyNotes.oninput = () => {
          node.notes = propertyNotes.value;
          renderNode(nodeId);
        };
      }

      function updateNodeCount() {
        nodesCount.textContent = `${nodes.length} Nodes`;
      }

      function updateEdgeCount() {
        edgesCount.textContent = `${edges.length} Connections`;
      }

      function renderEdges() {
        edgesGroup.innerHTML = '';
        edges.forEach(edge => {
          const fromNode = getNodeById(edge.from);
          const toNode = getNodeById(edge.to);
          if (fromNode && toNode) {
            const fromElement = document.getElementById(edge.from);
            const toElement = document.getElementById(edge.to);
            const startX = fromNode.x + fromElement.offsetWidth;
            const startY = fromNode.y + fromElement.offsetHeight / 2;
            const endX = toNode.x;
            const endY = toNode.y + toElement.offsetHeight / 2;

            const controlX1 = startX + (endX - startX) * 0.3;
            const controlX2 = startX + (endX - startX) * 0.7;
            const midX = startX + (endX - startX) * 0.5;
            const midY = startY + (endY - startY) * 0.5;

            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.classList.add('edge-group');
            group.dataset.edgeId = edge.id;

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.classList.add('edge-path');
            path.setAttribute('d', 
              `M${startX},${startY} C${controlX1},${startY} ${controlX2},${midY} ${midX},${midY} 
               M${midX},${midY} C${controlX2},${midY} ${controlX1},${endY} ${endX},${endY}`
            );
            if (selectedEdgeId === edge.id) path.classList.add('selected');

            group.appendChild(path);
            edgesGroup.appendChild(group);

            path.addEventListener('click', (e) => {
              e.stopPropagation();
              if (currentTool === 'select') {
                selectEdge(edge.id, midX, midY);
              }
            });

            if (selectedEdgeId === edge.id) {
              edgeMenu.style.left = `${(midX * zoom + panOffsetX + 10)}px`;
              edgeMenu.style.top = `${(midY * zoom + panOffsetY)}px`;
              edgeMenu.classList.add('visible');
            }
          }
        });
      }

      function selectEdge(edgeId, midX, midY) {
        if (selectedEdgeId) {
          const prevSelected = document.querySelector(`.edge-group[data-edge-id="${selectedEdgeId}"] .edge-path`);
          if (prevSelected) prevSelected.classList.remove('selected');
          edgeMenu.classList.remove('visible');
        }
        selectedEdgeId = edgeId;
        const selectedPath = document.querySelector(`.edge-group[data-edge-id="${edgeId}"] .edge-path`);
        if (selectedPath) selectedPath.classList.add('selected');
        edgeMenu.style.left = `${(midX * zoom + panOffsetX + 10)}px`;
        edgeMenu.style.top = `${(midY * zoom + panOffsetY)}px`;
        edgeMenu.classList.add('visible');

        edgeDeleteBtn.onclick = () => {
          deletePrompt.classList.add('visible');
          deleteConfirm.onclick = () => {
            removeEdge(edgeId);
            deletePrompt.classList.remove('visible');
            edgeMenu.classList.remove('visible');
          };
          deleteCancel.onclick = () => {
            deletePrompt.classList.remove('visible');
          };
        };

        edgeReverseBtn.onclick = () => {
          reverseEdge(edgeId);
          edgeMenu.classList.remove('visible');
        };

        if (selectedNodeId) {
          document.getElementById(selectedNodeId).classList.remove('selected');
          propertiesPanel.classList.remove('visible');
          selectedNodeId = null;
        }
      }

      function deselectEdge() {
        if (selectedEdgeId) {
          const selectedPath = document.querySelector(`.edge-group[data-edge-id="${selectedEdgeId}"] .edge-path`);
          if (selectedPath) selectedPath.classList.remove('selected');
          edgeMenu.classList.remove('visible');
          selectedEdgeId = null;
        }
      }

      function removeEdge(edgeId) {
        edges = edges.filter(e => e.id !== edgeId);
        renderEdges();
        updateEdgeCount();
        if (selectedEdgeId === edgeId) selectedEdgeId = null;
      }

      function reverseEdge(edgeId) {
        const edge = edges.find(e => e.id === edgeId);
        if (edge) {
          [edge.from, edge.to] = [edge.to, edge.from];
          renderEdges();
        }
      }

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Delete' && selectedNodeId) {
          deletePrompt.classList.add('visible');
          deleteConfirm.onclick = () => {
            removeNode(selectedNodeId);
            deletePrompt.classList.remove('visible');
          };
          deleteCancel.onclick = () => {
            deletePrompt.classList.remove('visible');
          };
        }
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.edge-group') && !e.target.closest('.edge-menu') && selectedEdgeId) {
          deselectEdge();
        }
      });
    });
  </script>
</body>
</html>
